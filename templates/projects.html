{% load static %}
<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UzDevHub - Loyihalar</title>
  <link rel="stylesheet" href="{% static 'css/projects.css' %}">
</head>
<body {% if request.COOKIES.theme == "light" %}class="light-mode"{% endif %}>

  {% include 'sidebar.html' %}

  <main class="main-content">
    <h1>Loyihalar</h1>

    <!-- JSON Data -->
<script id="project-json" type="application/json">
  {{ projects_json|json_script:"project-json" }}
</script>


    <!-- CARDLAR -->
    <div class="project-grid" id="project-container">
      {% for item in projects %}
      <div class="project-card" onclick="openModal('{{ item.id }}', '{{ item.slug }}')">
        {% if item.category %}
        <div class="category-badge">🏷️ {{ item.category.name }}</div>
        {% endif %}
        <h3>{{ item.title }}</h3>
        <p>{{ item.description|truncatechars:100 }}</p>
        <div class="owner">👤 {{ item.owner_name }} {{ item.owner_last_name }}</div>
        <div class="owner">📅 {{ item.datetime|date:"d.m.Y H:i" }}</div>
      </div>

      <div class="modal" id="modal-{{ item.id }}">
        <div class="modal-content">
          <span class="close" onclick="closeModal('{{ item.id }}')">&times;</span>
          <h2>{{ item.title }}</h2>
          <p><strong>Muallif:</strong> {{ item.owner_name }} {{ item.owner_last_name }}</p>
          <p>{{ item.description }}</p>
          {% if item.category %}
          <p><strong>Kategoriya:</strong> {{ item.category.name }}</p>
          {% endif %}
          <div class="modal-buttons">
            {% if item.file %}
            <a href="{{ item.file.url }}" download>📦 Faylni yuklash</a>
            {% endif %}
            {% if item.url %}
            <a href="{{ item.url }}" target="_blank">🔗 Linkga o‘tish</a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- LOAD MORE BUTTON -->
    {% if has_next %}
    <div class="load-more">
      <button id="load-btn" data-page="2">Ko‘proq</button>
    </div>
    {% endif %}

    <!-- + Qo‘shish -->
    <button id="open-add-modal" class="add-button">+</button>

    <!-- 2 BOSQICHLI FORMA -->
    <div id="add-modal" class="modal">
      <div class="modal-content">
        <span id="close-modal" class="close">&times;</span>
        <form id="add-project-form" enctype="multipart/form-data">
          <div id="form-step-1">
            <h2>Keling, tanishib olaylik.</h2>
            <input type="text" name="owner_name" placeholder="Ismingiz" required />
            <input type="text" name="owner_last_name" placeholder="Familyangiz" required />
            <input type="text" name="title" placeholder="loyihangiz sarlavhasi" required />
            <textarea name="description" placeholder="loyihangizga izoh" required></textarea>
            <button type="button" id="next-btn">Keyingi</button>
          </div>

          <div id="form-step-2" style="display: none;">
            <h2>Loyihangizni korsatingchi :)</h2>
            <input type="file" name="file" required />
            <input type="url" name="url" placeholder="Havola" />
            <select name="category" required>
              <option value="" disabled selected>Kategoriya tanlang</option>
              {% for cat in categories %}
              <option value="{{ cat.id }}">{{ cat.name }}</option>
              {% endfor %}
            </select>
            <div class="modal-buttons">
              <button type="button" id="back-btn">Ortga</button>
              <button type="submit" id="submit-btn">Qo‘shish</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- Toggle -->
  <button id="dark-toggle" title="Rejimni almashtirish">☀️</button>

  <!-- SCRIPTLAR -->
  <script src="{% static 'js/toggle.js' %}"></script>
  <script src="{% static 'js/add.js' %}"></script>
  <script src="{% static 'js/load.js' %}"></script>
  <script src="{% static 'js/modal.js' %}"></script>

</body>
</html>
